{% extends "base.html" %}

{% block content %}

<div class="page-header">
  <h1>Boom / Bust</h1>
  <p class="page-subtitle">Players outperforming or underperforming their projected averages this season</p>
</div>

<!-- ERROR STATE -->
{% if err %}
<div class="error-banner" role="alert">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
  </svg>
  {{ err }}
</div>
{% endif %}

{% if booms or busts %}

<!--SUMMARY CARDS -->
<div class="summary-row">
  <div class="summary-card boom-card">
    <div class="summary-num">{{ booms | length }}</div>
    <div class="summary-label">Boom Players</div>
    <div class="summary-sub">Exceeding projections</div>
  </div>
  <div class="summary-divider"></div>
  <div class="summary-card bust-card">
    <div class="summary-num">{{ busts | length }}</div>
    <div class="summary-label">Bust Players</div>
    <div class="summary-sub">Below projections</div>
  </div>
</div>

<!-- TAB BAR -->
<div class="tab-bar">
  <button class="tab-btn active" data-tab="boom">
    Boom Players
    <span class="tab-count">{{ booms | length }}</span>
  </button>
  <button class="tab-btn" data-tab="bust">
    Bust Players
    <span class="tab-count">{{ busts | length }}</span>
  </button>
</div>

<!-- BOOM TABLE -->
<div class="tab-panel" id="panel-boom">
  {% if booms %}
  <div class="table-wrapper">
    <table class="results-table">
      <thead>
        <tr>
          <th class="col-rank">#</th>
          <th class="col-name">Player</th>
          <th class="col-pos">Pos</th>
          <th class="col-avg">Actual Avg</th>
          <th class="col-proj">Proj Avg</th>
          <th class="col-score">Boom Score</th>
          <th class="col-bar"></th>
        </tr>
      </thead>
      <tbody>
        {% for player in booms %}
        <tr class="result-row">
          <td class="col-rank">
            {% if loop.index == 1 %}<span class="rank-badge rank-1">1</span>
            {% elif loop.index == 2 %}<span class="rank-badge rank-2">2</span>
            {% elif loop.index == 3 %}<span class="rank-badge rank-3">3</span>
            {% else %}<span class="rank-num">{{ loop.index }}</span>{% endif %}
          </td>
          <td class="col-name"><span class="player-name">{{ player.name or "—" }}</span></td>
          <td class="col-pos">
            {% if player.position %}
              <span class="pos-badge pos-{{ player.position | lower }}">{{ player.position }}</span>
            {% else %}—{% endif %}
          </td>
          <td class="col-avg"><span class="avg-value">{{ "%.1f" | format(player.avg_points) }}</span></td>
          <td class="col-proj"><span class="proj-value">{{ "%.1f" | format(player.projected_avg_points) }}</span></td>
          <td class="col-score">
            <span class="boom-score">+{{ "%.1f" | format(player.boom_score) }}</span>
          </td>
          <td class="col-bar">
            <div class="score-bar-track">
              {# cap visual at 20 pts above projection #}
              <div class="score-bar-fill boom-fill" style="width: {{ [((player.boom_score / 20) * 100), 100] | min | int }}%"></div>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="empty-state"><p>No boom players found.</p></div>
  {% endif %}
</div>

<!-- BUST TABLE -->
<div class="tab-panel hidden" id="panel-bust">
  {% if busts %}
  <div class="table-wrapper">
    <table class="results-table">
      <thead>
        <tr>
          <th class="col-rank">#</th>
          <th class="col-name">Player</th>
          <th class="col-pos">Pos</th>
          <th class="col-avg">Actual Avg</th>
          <th class="col-proj">Proj Avg</th>
          <th class="col-score">Bust Score</th>
          <th class="col-bar"></th>
        </tr>
      </thead>
      <tbody>
        {% for player in busts %}
        <tr class="result-row">
          <td class="col-rank">
            {% if loop.index == 1 %}<span class="rank-badge bust-rank-1">1</span>
            {% elif loop.index == 2 %}<span class="rank-badge bust-rank-2">2</span>
            {% elif loop.index == 3 %}<span class="rank-badge bust-rank-3">3</span>
            {% else %}<span class="rank-num">{{ loop.index }}</span>{% endif %}
          </td>
          <td class="col-name"><span class="player-name">{{ player.name or "—" }}</span></td>
          <td class="col-pos">
            {% if player.position %}
              <span class="pos-badge pos-{{ player.position | lower }}">{{ player.position }}</span>
            {% else %}—{% endif %}
          </td>
          <td class="col-avg"><span class="avg-value">{{ "%.1f" | format(player.avg_points) }}</span></td>
          <td class="col-proj"><span class="proj-value">{{ "%.1f" | format(player.projected_avg_points) }}</span></td>
          <td class="col-score">
            <span class="bust-score">{{ "%.1f" | format(player.boom_score) }}</span>
          </td>
          <td class="col-bar">
            <div class="score-bar-track">
              <div class="score-bar-fill bust-fill" style="width: {{ [((player.boom_score | abs / 20) * 100), 100] | min | int }}%"></div>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="empty-state"><p>No bust players found.</p></div>
  {% endif %}
</div>

{% else %}
<div class="empty-state">
  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2" opacity="0.3">
    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
  </svg>
  <p>No player data available. Check back once the season is underway.</p>
</div>
{% endif %}

<style>
.page-header { text-align: center; margin-bottom: 2rem; }
.page-header h1 { font-size: 1.8rem; color: #eaeaea; margin-bottom: 0.4rem; }
.page-subtitle { color: #888; font-size: 0.95rem; }

/* Error Banner */
.error-banner {
  max-width: 700px; margin: 0 auto 1.5rem;
  padding: 12px 16px; background: #3a1a1a;
  border: 1px solid #5a2a2a; border-radius: 8px;
  color: #ff8a8a; font-size: 0.9rem;
  display: flex; align-items: center; gap: 8px;
}

/* Summary Cards */
.summary-row {
  display: flex; align-items: stretch; justify-content: center;
  max-width: 520px; margin: 0 auto 2.5rem;
  background: #1a1a1a; border: 1px solid #2a2a2a;
  border-radius: 12px; overflow: hidden;
}
.summary-card {
  flex: 1; text-align: center;
  padding: 1.8rem 1.5rem;
}
.summary-divider { width: 1px; background: #2a2a2a; }
.summary-icon { font-size: 2rem; margin-bottom: 0.5rem; }
.summary-num { font-size: 2.4rem; font-weight: 800; margin-bottom: 0.2rem; font-variant-numeric: tabular-nums; }
.boom-card .summary-num { color: #6bcf7f; }
.bust-card .summary-num { color: #ff8a8a; }
.summary-label { font-size: 0.9rem; font-weight: 700; color: #eaeaea; }
.summary-sub { font-size: 0.78rem; color: #666; margin-top: 0.3rem; }

/* Tab Bar */
.tab-bar {
  display: flex; gap: 4px;
  max-width: 900px; margin: 0 auto 1.5rem;
  background: #1a1a1a; border: 1px solid #2a2a2a;
  border-radius: 10px; padding: 6px;
}
.tab-btn {
  flex: 1; display: flex; align-items: center; justify-content: center;
  gap: 8px; padding: 10px 20px;
  background: none; border: none; border-radius: 7px;
  font-size: 0.88rem; font-weight: 600; color: #666;
  cursor: pointer; transition: all 0.15s;
}
.tab-btn:hover { color: #aaa; background: #222; }
.tab-btn.active { background: #222; color: #eaeaea; }
.tab-btn.active[data-tab="boom"] { color: #6bcf7f; }
.tab-btn.active[data-tab="bust"] { color: #ff8a8a; }
.tab-count {
  display: inline-flex; align-items: center; justify-content: center;
  width: 22px; height: 22px; border-radius: 50%;
  font-size: 0.72rem; font-weight: 700;
  background: #2a2a2a; color: #888;
}
.tab-btn.active .tab-count { background: #333; color: #eaeaea; }

/* Panels */
.tab-panel { max-width: 900px; margin: 0 auto 5rem; }
.hidden { display: none; }

/* Table */
.table-wrapper { border: 1px solid #2a2a2a; border-radius: 10px; overflow: hidden; }
.results-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
.results-table thead { background: #1e1e1e; border-bottom: 1px solid #2a2a2a; }
.results-table th {
  padding: 11px 14px; text-align: left;
  font-size: 0.75rem; font-weight: 600;
  text-transform: uppercase; letter-spacing: 0.07em; color: #666;
}
.results-table th.col-rank,
.results-table th.col-avg,
.results-table th.col-proj,
.results-table th.col-score { text-align: center; }
.results-table th.col-bar { width: 100px; }

.result-row { border-bottom: 1px solid #1e1e1e; transition: background 0.12s; }
.result-row:last-child { border-bottom: none; }
.result-row:hover { background: #1e2530; }
.results-table td { padding: 11px 14px; color: #d0d0d0; vertical-align: middle; }
.results-table td.col-rank,
.results-table td.col-avg,
.results-table td.col-proj,
.results-table td.col-score { text-align: center; }

/* Rank badges */
.rank-badge {
  display: inline-flex; align-items: center; justify-content: center;
  width: 26px; height: 26px; border-radius: 50%;
  font-size: 0.8rem; font-weight: 700;
}
.rank-1 { background: #3a2e0a; color: #ffd700; }
.rank-2 { background: #252525; color: #c0c0c0; }
.rank-3 { background: #2a1a10; color: #cd7f32; }
.bust-rank-1 { background: #3a1515; color: #ff6b6b; }
.bust-rank-2 { background: #2a1a1a; color: #ff9999; }
.bust-rank-3 { background: #2a1818; color: #ffb3b3; }
.rank-num { color: #555; font-size: 0.85rem; }

.player-name { font-weight: 600; color: #eaeaea; }

.pos-badge {
  display: inline-block; padding: 3px 9px; border-radius: 4px;
  font-size: 0.78rem; font-weight: 700; letter-spacing: 0.04em;
  background: #1e2e4a; color: #7aa2ff;
}

.avg-value   { font-weight: 700; color: #eaeaea; font-variant-numeric: tabular-nums; }
.proj-value  { font-weight: 600; color: #7aa2ff; font-variant-numeric: tabular-nums; }
.boom-score  { font-weight: 800; color: #6bcf7f; font-variant-numeric: tabular-nums; }
.bust-score  { font-weight: 800; color: #ff8a8a; font-variant-numeric: tabular-nums; }

.score-bar-track {
  height: 6px; background: #2a2a2a; border-radius: 3px; overflow: hidden; min-width: 80px;
}
.score-bar-fill { height: 100%; border-radius: 3px; transition: width 0.5s ease; }
.boom-fill { background: linear-gradient(90deg, #2e8a45, #6bcf7f); }
.bust-fill { background: linear-gradient(90deg, #8a2e2e, #ff8a8a); }

/* Empty State */
.empty-state {
  text-align: center; padding: 4rem 2rem; color: #555;
  display: flex; flex-direction: column; align-items: center; gap: 1rem;
}
.empty-state p { font-size: 0.95rem; max-width: 360px; }
</style>

<script>
(function () {
  const tabs   = document.querySelectorAll('.tab-btn');
  const panels = { boom: document.getElementById('panel-boom'), bust: document.getElementById('panel-bust') };

  tabs.forEach(function (tab) {
    tab.addEventListener('click', function () {
      tabs.forEach(t => t.classList.remove('active'));
      this.classList.add('active');
      const target = this.dataset.tab;
      Object.entries(panels).forEach(([key, el]) => {
        if (el) el.classList.toggle('hidden', key !== target);
      });
    });
  });

  // Animate bars on load
  document.querySelectorAll('.score-bar-fill').forEach(function (bar) {
    const target = bar.style.width;
    bar.style.width = '0%';
    requestAnimationFrame(() => requestAnimationFrame(() => { bar.style.width = target; }));
  });
})();
</script>

{% endblock %}