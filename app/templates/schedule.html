{% extends "base.html" %}

{% block content %}

<div class="page-header">
  <h1>Schedule Tracker</h1>
  <p class="page-subtitle">Weekly matchups and games remaining</p>
</div>

<!-- WEEK SELECTOR -->
<div class="week-nav">
  {% for w in range(1, 11) %}
    <a href="{{ url_for('schedule', week=w) }}"
       class="week-pill {% if w == current_week %}active{% endif %}">
      Wk {{ w }}
    </a>
  {% endfor %}
</div>

<!-- ERROR STATE -->
{% if err %}
<div class="error-banner" role="alert">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <circle cx="12" cy="12" r="10"/>
    <line x1="12" y1="8" x2="12" y2="12"/>
    <line x1="12" y1="16" x2="12.01" y2="16"/>
  </svg>
  {{ err }}
</div>
{% endif %}

{% if schedule %}

<!-- GAMES LEFT SUMMARY BAR -->
{% if games_left %}
<div class="results-section">
  <div class="results-header">
    <h2>Games Remaining This Week</h2>
    <span class="results-count">Week {{ current_week }}</span>
  </div>
  <div class="games-left-grid">
    {% for team_id, count in games_left.items() %}
    <div class="games-left-card">
      <span class="games-left-count {% if count >= 4 %}count-high{% elif count >= 2 %}count-mid{% else %}count-low{% endif %}">
        {{ count }}
      </span>
      <span class="games-left-label">Team {{ team_id }}</span>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

<!-- MATCHUPS TABLE -->
<div class="results-section">
  <div class="results-header">
    <h2>Matchups</h2>
    <span class="results-count">{{ schedule | length }} game{% if schedule | length != 1 %}s{% endif %}</span>
  </div>

  <div class="table-wrapper">
    <table class="results-table">
      <thead>
        <tr>
          <th class="col-team">Your Team</th>
          <th class="col-ha">Home / Away</th>
          <th class="col-opp">Opponent</th>
          <th class="col-pts">Pts For</th>
          <th class="col-pts">Pts Against</th>
          <th class="col-result">Result</th>
        </tr>
      </thead>
      <tbody>
        {% for game in schedule %}
        {% set has_score = game.points_for is not none and game.points_against is not none %}
        {% set won = has_score and game.points_for > game.points_against %}
        {% set lost = has_score and game.points_for < game.points_against %}
        <tr class="result-row {% if won %}row-win{% elif lost %}row-loss{% endif %}">

          <!-- Your team -->
          <td class="col-team">
            <span class="team-name">{{ game.team_name or "—" }}</span>
          </td>

          <!-- Home / Away -->
          <td class="col-ha">
            <span class="ha-badge ha-{{ game.home_away }}">
              {{ game.home_away | upper }}
            </span>
          </td>

          <!-- Opponent -->
          <td class="col-opp">
            <span class="opp-name">{{ game.opponent_name or "TBD" }}</span>
          </td>

          <!-- Points for -->
          <td class="col-pts">
            {% if game.points_for is not none %}
              <span class="pts-value">{{ "%.1f" | format(game.points_for) }}</span>
            {% else %}
              <span class="pts-pending">—</span>
            {% endif %}
          </td>

          <!-- Points against -->
          <td class="col-pts">
            {% if game.points_against is not none %}
              <span class="pts-value">{{ "%.1f" | format(game.points_against) }}</span>
            {% else %}
              <span class="pts-pending">—</span>
            {% endif %}
          </td>

          <!-- Result -->
          <td class="col-result">
            {% if has_score %}
              {% if won %}
                <span class="result-badge result-win">W</span>
              {% elif lost %}
                <span class="result-badge result-loss">L</span>
              {% else %}
                <span class="result-badge result-tie">T</span>
              {% endif %}
            {% else %}
              <span class="result-badge result-upcoming">TBD</span>
            {% endif %}
          </td>

        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% else %}

<!-- EMPTY STATE -->
<div class="empty-state">
  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2" opacity="0.3">
    <rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/>
    <line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>
  </svg>
  <p>No matchups found for Week {{ current_week }}.</p>
</div>

{% endif %}

<style>
/* ── Layout ──────────────────────────────────────────────── */
.page-header {
  text-align: center;
  margin-bottom: 2rem;
}

.page-header h1 {
  font-size: 1.8rem;
  color: #eaeaea;
  margin-bottom: 0.4rem;
}

.page-subtitle {
  color: #888;
  font-size: 0.95rem;
}

/* ── Week Nav ────────────────────────────────────────────── */
.week-nav {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  justify-content: center;
  margin-bottom: 2rem;
}

.week-pill {
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
  text-decoration: none;
  color: #666;
  background: #1a1a1a;
  border: 1px solid #2a2a2a;
  transition: color 0.15s, border-color 0.15s, background 0.15s;
}

.week-pill:hover {
  color: #aaa;
  border-color: #3a3a3a;
  background: #222;
}

.week-pill.active {
  color: #7aa2ff;
  background: #1a2540;
  border-color: #3a5aaa;
}

/* ── Error Banner ────────────────────────────────────────── */
.error-banner {
  max-width: 600px;
  margin: 0 auto 1.5rem;
  padding: 12px 16px;
  background: #3a1a1a;
  border: 1px solid #5a2a2a;
  border-radius: 8px;
  color: #ff8a8a;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 8px;
}

/* ── Shared Section ──────────────────────────────────────── */
.results-section {
  max-width: 900px;
  margin: 0 auto 2rem;
  width: 100%;
}

.results-header {
  display: flex;
  align-items: baseline;
  justify-content: space-between;
  margin-bottom: 1rem;
  padding: 0 2px;
}

.results-header h2 {
  font-size: 1.1rem;
  color: #eaeaea;
  margin: 0;
}

.results-count {
  font-size: 0.8rem;
  color: #666;
}

/* ── Games Left Grid ─────────────────────────────────────── */
.games-left-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.games-left-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding: 12px 18px;
  background: #1a1a1a;
  border: 1px solid #2a2a2a;
  border-radius: 8px;
  min-width: 72px;
}

.games-left-count {
  font-size: 1.6rem;
  font-weight: 700;
  font-variant-numeric: tabular-nums;
  line-height: 1;
}

.count-high { color: #6bcf7f; }
.count-mid  { color: #ffd93d; }
.count-low  { color: #ff8a8a; }

.games-left-label {
  font-size: 0.72rem;
  color: #555;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

/* ── Table ───────────────────────────────────────────────── */
.table-wrapper {
  border: 1px solid #2a2a2a;
  border-radius: 10px;
  overflow: hidden;
}

.results-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.9rem;
}

.results-table thead {
  background: #1e1e1e;
  border-bottom: 1px solid #2a2a2a;
}

.results-table th {
  padding: 11px 14px;
  text-align: left;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.07em;
  color: #666;
}

.results-table th.col-pts,
.results-table th.col-result,
.results-table th.col-ha {
  text-align: center;
}

.result-row {
  border-bottom: 1px solid #1e1e1e;
  transition: background 0.12s;
}

.result-row:last-child { border-bottom: none; }
.result-row:hover      { background: #1e2530; }
.result-row.row-win    { background: #0f2018; }
.result-row.row-win:hover  { background: #152a20; }
.result-row.row-loss   { background: #20100f; }
.result-row.row-loss:hover { background: #2a1515; }

.results-table td {
  padding: 12px 14px;
  color: #d0d0d0;
  vertical-align: middle;
}

.results-table td.col-pts,
.results-table td.col-result,
.results-table td.col-ha {
  text-align: center;
}

/* Team / opp names */
.team-name {
  font-weight: 600;
  color: #eaeaea;
}

.opp-name {
  color: #aaa;
}

/* Home/Away badge */
.ha-badge {
  display: inline-block;
  padding: 3px 9px;
  border-radius: 4px;
  font-size: 0.75rem;
  font-weight: 700;
  letter-spacing: 0.05em;
}

.ha-home { background: #1e2e4a; color: #7aa2ff; }
.ha-away { background: #2a2040; color: #b07aff; }

/* Points */
.pts-value {
  font-variant-numeric: tabular-nums;
  font-weight: 600;
  color: #c8e6ff;
}

.pts-pending { color: #444; }

/* Result badges */
.result-badge {
  display: inline-block;
  padding: 3px 10px;
  border-radius: 4px;
  font-size: 0.78rem;
  font-weight: 700;
  letter-spacing: 0.04em;
}

.result-win      { background: #1e3a2a; color: #6bcf7f; }
.result-loss     { background: #3a1e1e; color: #ff8a8a; }
.result-tie      { background: #2a2a1e; color: #ffd93d; }
.result-upcoming { background: #222; color: #555; }

/* ── Empty State ─────────────────────────────────────────── */
.empty-state {
  text-align: center;
  padding: 4rem 2rem;
  color: #555;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
}

.empty-state p {
  font-size: 0.95rem;
  max-width: 360px;
}
</style>

{% endblock %}